name: Daily Trend Scanner

on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  trigger-scanner:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Trigger Writer Blueprint
        run: |
          echo "üöÄ Triggering Writer Blueprint..."
          
          response=$(curl -w "\nHTTP_STATUS:%{http_code}" -s \
            --location --request POST \
            "https://api.writer.com/v1/blueprints/${{ secrets.WRITER_BLUEPRINT_ID }}/run" \
            --header "Authorization: Bearer ${{ secrets.WRITER_API_KEY }}" \
            --header "Content-Type: application/json" \
            --data '{"inputs": []}')
          
          # Extract HTTP status code
          http_status=$(echo "$response" | grep -o "HTTP_STATUS:[0-9]*" | cut -d: -f2)
          response_body=$(echo "$response" | sed '/HTTP_STATUS:/d')
          
          echo "HTTP Status: $http_status"
          echo "Response: $response_body"
          
          # Check if successful
          if [ "$http_status" = "200" ] || [ "$http_status" = "201" ]; then
            echo "‚úì Blueprint triggered successfully!"
            exit 0
          else
            echo "‚ùå Failed with status $http_status"
            echo "Response body: $response_body"
            exit 1
          fi
      
      - name: Wait for processing
        run: |
          echo "‚è≥ Waiting 60 seconds for blueprint to complete..."
          sleep 60
          echo "‚úì Done! Check your Knowledge Graph in Writer for the new report."
